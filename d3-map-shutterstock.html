<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <meta content="description" name="description">
  <meta name="google" content="notranslate" />
  <meta content="Rabih Abou Fakher - Software Engineer" name="Rabih Abou Fakher">

  <!-- Disable tap highlight on IE -->
  <meta name="msapplication-tap-highlight" content="no">

  <!-- <link href="./assets/favicon.ico" rel="icon"> -->
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <title>D3 Interactive Map Shutterstock</title>
  <style>
    .hidden {
      display: none;
    }

    div.countryLabel {
      color: #222;
      background: #fff;
      border-radius: 3px;
      box-shadow: 0px 0px 2px 0px #a6a6a6;
      padding: .2em;
      text-shadow: #f5f5f5 0 1px 0;
      opacity: 0.9;
      position: absolute;
    }

    .x {
      background-color: red;
      border: none;
      color: white;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
    }
  </style>

  <link href="./assets/style/main.3f6952e4.css" rel="stylesheet">
</head>

<body class="minimal">
  <div id="site-border-left"></div>
  <div id="site-border-right"></div>
  <div id="site-border-top"></div>
  <div id="site-border-bottom"></div>
  <!-- Add your content of header -->
  <header>
    <nav class="navbar  navbar-fixed-top navbar-default">
      <div class="container">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"
          aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar-collapse">
          <ul class="nav navbar-nav ">
            <li><a href="./index.html" title="">Home</a></li>
            <li><a href="./projects.html" title="">Projects</a></li>
            <li><a href="./certification.html" title="">Certification</a></li>
            <li><a href="./blog.html" title="">Blog</a></li>
            <li><a href="./contact.html" title="">Contact</a></li>
            <li><a href="./fun.html" title="">Fun!</a></li>
            <li><a href="./d3-map-shutterstock.html" title=""><b>Interactive Map</b></a></li>
          </ul>

        </div>

        <button type="button" class="x" id="close" name="close" onclick="closeAndClear()" hidden>X</button>
        <label id="desc" name="desc" hidden></label>

      </div>
    </nav>
  </header>

  <div class="hero-full-container white-text-container" style="background-color:white;">

    <svg></svg>
    &nbsp; &nbsp; &nbsp;
    <label>API Token:</label>
    <input type="text" id="shutterstockToken" size="28" placeholder="Shutterstock token goes here">
    &nbsp; &nbsp; &nbsp; &nbsp;
    <input type="radio" id="shutterstockImageType" name="shutterstockFetchType" value="image" checked>
    <label>Image</label>
    <input type="radio" id="shutterstockVideoType" name="shutterstockFetchType" value="video">
    <label>Video</label>

    <div class="countryLabel"></div>

    <script>
      const margin = { top: 15, right: 10, bottom: 50, left: 10 };
      const width = window.innerWidth - margin.left - margin.right;
      const height = window.innerHeight - margin.top - margin.bottom;

      const projection = d3.geoEquirectangular()
        .translate([width / 2, height / 2])
        .scale((width - 1) / 3 / Math.PI);

      const path = d3.geoPath()
        .projection(projection);

      const svg = d3.select("svg")
        .attr("width", width)
        .attr("height", height);

      const g = svg.append("g");

      const zoom = d3.zoom()
        .scaleExtent([1, 8])
        .on('zoom', function () {
          svg.selectAll('path')
            .attr('transform', d3.event.transform);
        });

      const countryLabel = d3.select("div.countryLabel");

      // load countries and map their names
      d3.queue()
        .defer(d3.json, "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
        .defer(d3.csv, "./assets/data/world-country-names.csv")
        .await(ready);
      function ready(error, world, names) {
        if (error) throw error;
        var countries1 = topojson.feature(world, world.objects.countries).features;
        countries = countries1.filter(function (d) {
          return names.some(function (n) {
            if (d.id == n.id) return d.name = n.name;
          })
        });

        svg.selectAll("path")
          .data(countries)
          .enter()
          .append("path")
          .attr("stroke", "#000000")
          .attr("stroke-width", 1)
          .attr("fill", "white")
          .attr("d", path)
          .call(zoom)
          .on("mouseover", function (d, i) {
            d3.select(this).attr("fill", "#000000").attr("stroke-width", 2);
            return countryLabel.style("hidden", false).html(d.name);
          })
          .on("mousemove", function (d) {
            countryLabel.classed("hidden", false)
              .style("top", (d3.event.pageY) + "px")
              .style("left", (d3.event.pageX + 10) + "px")
              .html(d.name);
          })
          .on("mouseout", function (d, i) {
            d3.select(this).attr("fill", "white").attr("stroke-width", 1);
            countryLabel.classed("hidden", true);
          })
          .on("click", function (d) {
            closeAndClear();
            const token = document.getElementById("shutterstockToken").value;
            const desc = document.getElementById("desc");
            const x = document.getElementById("close");
            if (token) {
              const shutterstockFetchType = document.querySelector('input[name="shutterstockFetchType"]:checked').value
              axios.get('https://api.shutterstock.com/v2/' + shutterstockFetchType + 's/search?query=' + encodeURIComponent(d.name), {
                headers: {
                  Authorization: 'Bearer ' + token.trim()
                }
              })
                .then((response) => {
                  const item = response.data.data[Math.floor(Math.random() * response.data.data.length)];

                  if ("image" === shutterstockFetchType) {
                    const image = svg.append('image')
                      .attr('xlink:href', item.assets.preview.url)
                      .attr('width', item.assets.preview.width)
                      .attr('height', item.assets.preview.height)
                      .attr('x', width / 2 - item.assets.preview.height / 2)
                      .attr('y', height / 2 - item.assets.preview.height / 2);
                  } else {
                    const fObj = svg.append("foreignObject");
                    fObj.attr("x", "20%")
                      .attr("y", "10%")
                      .attr("width", "60%")
                      .attr("height", "80%");
                    const vidObj = fObj.append("xhtml:video");
                    vidObj.attr("width", "100%")
                      .attr("height", "100%")
                      .attr("controls", "true")
                      .attr("autoplay", "true");
                    const src = vidObj.append("xhtml:source");
                    src.attr("type", "video/mp4")
                      .attr("src", item.assets.preview_mp4.url);

                    const foreignObject = svg.select("foreignObject");
                  }

                  x.style.display = "block";
                  desc.innerHTML = d.name + " - " + item.description;
                  desc.style.display = "block";

                }).catch((error) => {
                  console.log(error);
                  if (error?.response?.statusText) {
                    console.log(error.response);
                    alert(error.response.statusText);
                  }
                });
            } else {
              document.getElementById("shutterstockToken").focus();
              desc.innerHTML = "Please provide Shutterstock API Token";
              desc.style.display = "block";
              x.style.display = "block";
            }
          });
      };

      function closeAndClear() {
        const x = document.getElementById("close");
        x.style.display = "none";
        svg.selectAll("image").remove();
        svg.selectAll("foreignObject").remove();
        const desc = document.getElementById("desc");
        desc.style.display = "none";
      }

    </script>

  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function (event) {
      navActivePage();
    });
  </script>


  <script type="text/javascript" src="./assets/scripts/main.70a66962.js"></script>
</body>

</html>